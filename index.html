<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        padding: 16px;
    }

    input {
        padding: 8px;
        width: 250px;
        font-size: 15px;
    }

    button {
        font-size: 15px;
        padding: 8px;
        cursor: pointer;
    }

    ul {
        padding: 0px;
    }

    #loader {
        margin: 5px;
        display: none;
    }

    ul {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .liInfo {
        list-style: none;
    }
</style>

<body>
    <h1>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–µ</h1>
    <input id="input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã" />
    <button id="btn">–ü–æ–∏—Å–∫</button>
    <div id="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <ul id="result"></ul>
    <script>
    const apiByName = "https://restcountries.com/v2/name/";
    const apiByCode = "https://restcountries.com/v2/alpha/";

    // üîπ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç—Ä–∞–Ω —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏
    const specialCases = {
        "—Ä–æ—Å—Å–∏—è": "Russian Federation",
        "—Å—à–∞": "United States of America",
        "–∞–º–µ—Ä–∏–∫–∞": "United States of America",
        "–≤–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è": "United Kingdom",
        "–∫–∞–∑–∞—Ö—Å—Ç–∞–Ω": "Kazakhstan",
        "—É–∫—Ä–∞–∏–Ω–∞": "Ukraine",
        "–±–µ–ª–∞—Ä—É—Å—å": "Belarus",
        "—é–∂–Ω–∞—è –∫–æ—Ä–µ—è": "Korea (Republic of)",
        "—Å–µ–≤–µ—Ä–Ω–∞—è –∫–æ—Ä–µ—è": "Korea (Democratic People's Republic of)",
        "—Ç—É—Ä—Ü–∏—è": "Turkey",
        "–≥–µ—Ä–º–∞–Ω–∏—è": "Germany",
        "—Ñ—Ä–∞–Ω—Ü–∏—è": "France",
        "—è–ø–æ–Ω–∏—è": "Japan",
        "–∫–∏—Ç–∞–π": "China",
        "–∏—Ç–∞–ª–∏—è": "Italy",
        "–∏—Å–ø–∞–Ω–∏—è": "Spain",
        "–∫–∞–Ω–∞–¥–∞": "Canada"
    };

    async function translateToEnglish(text) {
        const res = await fetch(
            `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=en&dt=t&q=${encodeURIComponent(text)}`
        );
        const data = await res.json();
        return data[0][0][0];
    }

    async function getWeather(city) {
        const res = await fetch(`https://wttr.in/${city}?format=j1`);
        const data = await res.json();
        const cond = data.current_condition[0];
        return `${cond.weatherDesc[0].value}, ${cond.temp_C}¬∞C, Wind: ${cond.winddir16Point} ${cond.windspeedKmph} km/h`;
    }

    async function getCountryByName(name) {
        const res = await fetch(`${apiByName}${encodeURIComponent(name)}`);
        if (!res.ok) throw new Error("–°—Ç—Ä–∞–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
        const data = await res.json();
        return data[0];
    }

    async function getCountryByCode(code) {
        const res = await fetch(`${apiByCode}${code}`);
        return await res.json();
    }

    async function handleSearch() {
        result.innerHTML = "";
        loader.style.display = "block";

        try {
            let countryName = input.value.trim().toLowerCase();
            if (!countryName) throw new Error("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã!");

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Ç–∞–±–ª–∏—Ü–µ —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
            if (specialCases[countryName]) {
                countryName = specialCases[countryName];
            } else if (/[–∞-—è–ê-–Ø]/.test(countryName)) {
                // –ï—Å–ª–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ ‚Äî –ø–µ—Ä–µ–≤–æ–¥–∏–º
                countryName = await translateToEnglish(countryName);
            }

            const country = await getCountryByName(countryName);
            const capital = country.capital;
            const weather = await getWeather(capital);

            const li = document.createElement("li");
            li.style.listStyle = "none";
            li.innerHTML = `
                <b>Country:</b> ${country.name}<br>
                <b>Capital:</b> ${capital}<br>
                <b>Region:</b> ${country.region}<br>
                <b>Population:</b> ${country.population.toLocaleString()}<br>
                <img src="${country.flags.png}" width="80"><br>
                <b>Current weather:</b> ${weather}
            `;
            result.appendChild(li);

            if (country.borders) {
                const liBorder = document.createElement("li");
                liBorder.innerHTML = "<b>Bordering countries:</b>";
                liBorder.style.listStyle = "none";
                result.appendChild(liBorder);

                for (let code of country.borders) {
                    try {
                        const neighbor = await getCountryByCode(code);
                        const neighborCapital = neighbor.capital;
                        if (!neighborCapital) continue;

                        const neighborWeather = await getWeather(neighborCapital);

                        const liN = document.createElement("li");
                        const liCapital = document.createElement("li");
                        const liWttr = document.createElement("li");

                        liN.innerHTML = `<b>Country name:</b> ${neighbor.name}`;
                        liCapital.innerHTML = `<b>Capital:</b> ${neighborCapital}`;
                        liWttr.innerHTML = `<b>Current weather:</b> ${neighborWeather}`;

                        liN.style.marginLeft = "20px";
                        liCapital.style.marginLeft = "100px";
                        liWttr.style.marginLeft = "100px";

                        result.appendChild(liN);
                        result.appendChild(liCapital);
                        result.appendChild(liWttr);
                    } catch (err) {
                        console.error("–û—à–∏–±–∫–∞ —Å–æ—Å–µ–¥–∞:", err.message);
                    }
                }
            }

        } catch (err) {
            const liError = document.createElement("li");
            liError.textContent = err.message;
            liError.style.color = "red";
            liError.style.listStyle = "none";
            result.appendChild(liError);
        } finally {
            loader.style.display = "none";
        }
    }

    btn.addEventListener("click", handleSearch);
    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            e.preventDefault();
            handleSearch();
        }
    });
</script>

</body>

</html>
